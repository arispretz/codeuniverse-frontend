<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/pages/public/SignIn.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/pages/public/SignIn.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview SignIn component.
 * Handles user authentication via email/password or OAuth providers.
 * Supports both login and registration flows.
 *
 * @module pages/public/SignIn
 */

import React, { useState, useEffect, useRef } from 'react';
import {
  Box,
  Container,
  Divider,
  Button,
  Typography,
  CircularProgress,
  Alert,
} from '@mui/material';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import { syncUserAndRedirect } from '../../utils/syncUserAndRedirect.js';
import { auth } from '../../firebase/auth.js';
import {
  signInWithRedirect,
  getRedirectResult,
  signInWithEmailAndPassword,
} from '../../firebase/authUtils.js';
import { googleProvider, githubProvider } from '../../firebase/auth.js';
import { sendPasswordResetEmail, createUserWithEmailAndPassword } from 'firebase/auth';
import { useUser } from '../../hooks/useUser.jsx';
import FormCard from '../../components/FormCard.jsx';
import Input from '../../components/Input.jsx';
import AuthProviderButton from '../../components/AuthProviderButton.jsx';
import { setPersistence, browserLocalPersistence } from 'firebase/auth';
import { getRedirectForRole } from '../../utils/getRedirectForRole.js';

/**
 * SignIn component.
 * Provides authentication via email/password or social providers (Google, GitHub).
 * Handles both sign-in and registration flows with error handling and redirects.
 *
 * @function SignIn
 * @returns {JSX.Element} Sign-in page layout
 */
const SignIn = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const navigate = useNavigate();
  const location = useLocation();
  const fromPath = location.state?.from?.pathname;
  const isRegister = location.pathname.includes('register');

  const { isAuthenticated, role, loading: userLoading, setUser, setRole } = useUser();
  const hasHandledRedirect = useRef(false);

  /**
   * Redirects authenticated users away from auth pages.
   */
  useEffect(() => {
    const authPages = ['/sign-in', '/register'];
    const currentPath = location.pathname;

    if (isAuthenticated &amp;&amp; !userLoading &amp;&amp; authPages.includes(currentPath)) {
      const fallbackPath = getRedirectForRole(role);
      navigate(fromPath || fallbackPath);
    }
  }, [isAuthenticated, userLoading, role, navigate, fromPath, location.pathname]);

  /**
   * Checks for redirect results from OAuth providers.
   */
  useEffect(() => {
    const checkRedirectResult = async () => {
      if (hasHandledRedirect.current) return;
      try {
        const result = await getRedirectResult(auth);
        if (result?.user) {
          hasHandledRedirect.current = true;
          const storedPath = localStorage.getItem('redirectAfterLogin');
          localStorage.removeItem('redirectAfterLogin');
          const fallbackPath = getRedirectForRole('guest');
          await syncUserAndRedirect(result.user, navigate, setUser, setRole, fallbackPath, storedPath);
        }
      } catch (err) {
        setError(`Sign-in error: ${err.message}`);
      }
    };

    checkRedirectResult();
  }, [navigate, setUser, setRole]);

  /**
   * Handles OAuth sign-in via Google or GitHub.
   * @param {string} providerName - The provider to use ("google" or "github").
   */
  const handleSocialRedirect = async (providerName) => {
    setError('');
    setIsSubmitting(true);

    localStorage.removeItem('token');
    localStorage.removeItem('role');

    const provider = providerName === 'google' ? googleProvider : githubProvider;

    try {
      await setPersistence(auth, browserLocalPersistence);
      if (fromPath) {
        localStorage.setItem('redirectAfterLogin', fromPath);
      }
      await signInWithRedirect(auth, provider);
    } catch (err) {
      setError(`Failed to sign in with ${providerName}: ${err.message}`);
      setIsSubmitting(false);
    }
  };

  /**
   * Handles email/password sign-in or registration.
   */
  const handleSubmit = async () => {
    if (!email || !password) {
      setError('Email and password are required');
      return;
    }

    localStorage.removeItem('token');
    localStorage.removeItem('role');

    setError('');
    setIsSubmitting(true);

    try {
      let user;
      if (isRegister) {
        const result = await createUserWithEmailAndPassword(auth, email, password);
        user = result.user;
      } else {
        const result = await signInWithEmailAndPassword(auth, email, password);
        user = result.user;
      }

      const fallbackPath = getRedirectForRole('guest');
      await syncUserAndRedirect(user, navigate, setUser, setRole, fallbackPath, fromPath);
    } catch (err) {
      const errorMap = {
        'auth/user-not-found': 'User not found',
        'auth/wrong-password': 'Incorrect password',
        'auth/email-already-in-use': 'Email already registered',
        'auth/invalid-email': 'Invalid email format',
        'auth/weak-password': 'Password should be at least 6 characters',
      };
      setError(errorMap[err.code] || 'Something went wrong, please try again');
    } finally {
      setIsSubmitting(false);
    }
  };

  /**
   * Handles password reset via email.
   */
  const handlePasswordReset = async () => {
    if (!email) {
      setError('Please enter your email to reset password');
      return;
    }

    try {
      await sendPasswordResetEmail(auth, email);
      setError('We sent you a recovery email ðŸ“©');
    } catch (err) {
      setError(
        err.code === 'auth/user-not-found'
          ? 'No user found with that email'
          : 'Something went wrong. Try again'
      );
    }
  };

  if (loading || userLoading) {
    return (
      &lt;Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100vh' }}>
        &lt;CircularProgress />
        &lt;Typography variant="h6" sx={{ ml: 2 }}>
          Loading authentication...
        &lt;/Typography>
      &lt;/Box>
    );
  }

  return (
    &lt;Box sx={{ bgcolor: 'background.default', minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
      &lt;Container maxWidth="sm">
        &lt;FormCard
          title={isRegister ? 'Create your account' : 'Welcome back'}
          subtitle={isRegister ? 'Sign up to get started.' : 'Sign in to your workspace.'}
          loading={isSubmitting}
          footer={
            &lt;Typography variant="body2" align="center">
              {isRegister ? 'Already have an account?' : 'Donâ€™t have an account?'}{' '}
              &lt;Link
                to={isRegister ? '/sign-in' : '/register'}
                style={{ color: '#90caf9', textDecoration: 'none' }}
              >
                {isRegister ? 'Sign In' : 'Sign Up'}
              &lt;/Link>
            &lt;/Typography>
          }
        >
          {error &amp;&amp; (
            &lt;Alert severity="error" sx={{ mb: 2 }}>
              {error}
            &lt;/Alert>
          )}

          &lt;AuthProviderButton provider="google" onClick={() => handleSocialRedirect('google')} />
          &lt;AuthProviderButton provider="github" onClick={() => handleSocialRedirect('github')} />

          &lt;Divider sx={{ my: 2 }}>
            {isRegister ? 'or sign up with email' : 'or sign in with email'}
          &lt;/Divider>

          &lt;Input
            label="Email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            error={!!error &amp;&amp; !email}
            helperText={!email &amp;&amp; error ? 'Email is required' : ''}
            aria-label="email"
          />
          &lt;Input
            label="Password"
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            error={!!error &amp;&amp; !password}
            helperText={!password &amp;&amp; error ? 'Password is required' : ''}
            aria-label="password"
          />

          &lt;Button
            fullWidth
            variant="contained"
            disabled={isSubmitting}
            sx={{ mt: 2, textTransform: 'none', fontWeight: 600 }}
            onClick={handleSubmit}
          >
            {isSubmitting
              ? isRegister
                ? 'Creating accountâ€¦'
                : 'Signing inâ€¦'
              : isRegister
              ? 'Sign Up'
              : 'Sign In'}
          &lt;/Button>

          {!isRegister &amp;&amp; (
            &lt;Typography
              variant="body2"
              align="center"
              sx={{ mt: 2, cursor: 'pointer', color: '#90caf9' }}
                            onClick={handlePasswordReset}
              aria-label="forgot-password"
            >
              Forgot your password?
            &lt;/Typography>
          )}
        &lt;/FormCard>
      &lt;/Container>
    &lt;/Box>
  );
};

export default SignIn;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="babel.module_config.html">babel.config</a></li><li><a href="eslint.module_config.html">eslint.config</a></li><li><a href="jest.module_config.html">jest.config</a></li><li><a href="jest.module_setup.html">jest.setup</a></li><li><a href="module-ColorModeContext.html">ColorModeContext</a></li><li><a href="module-ThemeWrapper.html">ThemeWrapper</a></li><li><a href="module-auth_roles.html">auth/roles</a></li><li><a href="module-auth_useFirebaseAuth.html">auth/useFirebaseAuth</a></li><li><a href="module-components_AssistantSidebar.html">components/AssistantSidebar</a></li><li><a href="module-components_AuthProviderButton.html">components/AuthProviderButton</a></li><li><a href="module-components_Column.html">components/Column</a></li><li><a href="module-components_ColumnDroppable.html">components/ColumnDroppable</a></li><li><a href="module-components_EditorPanel.html">components/EditorPanel</a></li><li><a href="module-components_ErrorBoundaryWrapper.html">components/ErrorBoundaryWrapper</a></li><li><a href="module-components_FileTree.html">components/FileTree</a></li><li><a href="module-components_Footer.html">components/Footer</a></li><li><a href="module-components_FormCard.html">components/FormCard</a></li><li><a href="module-components_Input.html">components/Input</a></li><li><a href="module-components_KanbanModals.html">components/KanbanModals</a></li><li><a href="module-components_KanbanOverlay.html">components/KanbanOverlay</a></li><li><a href="module-components_KanbanTaskPreview.html">components/KanbanTaskPreview</a></li><li><a href="module-components_KanbanUtils.html">components/KanbanUtils</a></li><li><a href="module-components_Loading.html">components/Loading</a></li><li><a href="module-components_LocalTaskPanel.html">components/LocalTaskPanel</a></li><li><a href="module-components_Logo.html">components/Logo</a></li><li><a href="module-components_OutputPanel.html">components/OutputPanel</a></li><li><a href="module-components_PersonalTaskPreview.html">components/PersonalTaskPreview</a></li><li><a href="module-components_PersonalTasksPanel.html">components/PersonalTasksPanel</a></li><li><a href="module-components_ProjectSelector.html">components/ProjectSelector</a></li><li><a href="module-components_ProjectSummaryDashboard.html">components/ProjectSummaryDashboard</a></li><li><a href="module-components_RedirectHandler.html">components/RedirectHandler</a></li><li><a href="module-components_SortableTask.html">components/SortableTask</a></li><li><a href="module-components_SuspenseWrapper.html">components/SuspenseWrapper</a></li><li><a href="module-components_TaskCard.html">components/TaskCard</a></li><li><a href="module-components_TaskComments.html">components/TaskComments</a></li><li><a href="module-components_TaskFilters.html">components/TaskFilters</a></li><li><a href="module-components_TerminalPanel.html">components/TerminalPanel</a></li><li><a href="module-components_UserProfilePanel.html">components/UserProfilePanel</a></li><li><a href="module-components_modals_AddKanbanTaskModal.html">components/modals/AddKanbanTaskModal</a></li><li><a href="module-components_modals_AddTaskModal.html">components/modals/AddTaskModal</a></li><li><a href="module-components_modals_DeleteTaskModal.html">components/modals/DeleteTaskModal</a></li><li><a href="module-components_modals_EditLocalTaskModal.html">components/modals/EditLocalTaskModal</a></li><li><a href="module-components_modals_EditTaskModal.html">components/modals/EditTaskModal</a></li><li><a href="module-components_modals_LogoutModal.html">components/modals/LogoutModal</a></li><li><a href="module-components_modals_NewKanbanListModal.html">components/modals/NewKanbanListModal</a></li><li><a href="module-components_modals_NewListModal.html">components/modals/NewListModal</a></li><li><a href="module-components_modals_NewProjectModal.html">components/modals/NewProjectModal</a></li><li><a href="module-components_modals_ProjectDetailModal.html">components/modals/ProjectDetailModal</a></li><li><a href="module-components_modals_TaskDetailModal.html">components/modals/TaskDetailModal</a></li><li><a href="module-components_navbar_NavCategory.html">components/navbar/NavCategory</a></li><li><a href="module-components_navbar_Navbar.html">components/navbar/Navbar</a></li><li><a href="module-components_navbar_navDropdowns.html">components/navbar/navDropdowns</a></li><li><a href="module-context_AuthContext.html">context/AuthContext</a></li><li><a href="module-context_AuthProvider.html">context/AuthProvider</a></li><li><a href="module-context_ModalContext.html">context/ModalContext</a></li><li><a href="module-context_ModalProvider.html">context/ModalProvider</a></li><li><a href="module-firebase_auth.html">firebase/auth</a></li><li><a href="module-firebase_authUtils.html">firebase/authUtils</a></li><li><a href="module-hooks_init.html">hooks/init</a></li><li><a href="module-hooks_useAuth.html">hooks/useAuth</a></li><li><a href="module-hooks_useModal.html">hooks/useModal</a></li><li><a href="module-hooks_useUser.html">hooks/useUser</a></li><li><a href="module-hooks_utilsAuth.html">hooks/utilsAuth</a></li><li><a href="module-layouts_PrivateLayout.html">layouts/PrivateLayout</a></li><li><a href="module-layouts_PublicLayout.html">layouts/PublicLayout</a></li><li><a href="module-layouts_RootLayout.html">layouts/RootLayout</a></li><li><a href="module-main.html">main</a></li><li><a href="module-pages_AdminUserPanel.html">pages/AdminUserPanel</a></li><li><a href="module-pages_CodeReviewPanel.html">pages/CodeReviewPanel</a></li><li><a href="module-pages_CollaborativeCodeEditor.html">pages/CollaborativeCodeEditor</a></li><li><a href="module-pages_Dashboard.html">pages/Dashboard</a></li><li><a href="module-pages_KanbanBoard.html">pages/KanbanBoard</a></li><li><a href="module-pages_LocalTaskBoard.html">pages/LocalTaskBoard</a></li><li><a href="module-pages_MyProjects.html">pages/MyProjects</a></li><li><a href="module-pages_NotFound.html">pages/NotFound</a></li><li><a href="module-pages_PersonalTasksBoard.html">pages/PersonalTasksBoard</a></li><li><a href="module-pages_Profile.html">pages/Profile</a></li><li><a href="module-pages_ProjectDashboard.html">pages/ProjectDashboard</a></li><li><a href="module-pages_ProjectDocumentation.html">pages/ProjectDocumentation</a></li><li><a href="module-pages_ProjectManagementDashboard.html">pages/ProjectManagementDashboard</a></li><li><a href="module-pages_Settings.html">pages/Settings</a></li><li><a href="module-pages_TasksPage.html">pages/TasksPage</a></li><li><a href="module-pages_TeamChatModule.html">pages/TeamChatModule</a></li><li><a href="module-pages_docs_QuickStartGuide.html">pages/docs/QuickStartGuide</a></li><li><a href="module-pages_public__HelpCenter.html">pages/public//HelpCenter</a></li><li><a href="module-pages_public_AIAssistant.html">pages/public/AIAssistant</a></li><li><a href="module-pages_public_Blog.html">pages/public/Blog</a></li><li><a href="module-pages_public_ContactSupport.html">pages/public/ContactSupport</a></li><li><a href="module-pages_public_Features.html">pages/public/Features</a></li><li><a href="module-pages_public_ForDevelopers.html">pages/public/ForDevelopers</a></li><li><a href="module-pages_public_Home.html">pages/public/Home</a></li><li><a href="module-pages_public_PrivacyPolicy.html">pages/public/PrivacyPolicy</a></li><li><a href="module-pages_public_SignIn.html">pages/public/SignIn</a></li><li><a href="module-pages_public_SignUp.html">pages/public/SignUp</a></li><li><a href="module-pages_public_TermsOfService.html">pages/public/TermsOfService</a></li><li><a href="module-pages_public_Testimonials.html">pages/public/Testimonials</a></li><li><a href="module-routes_AdminDashboardRoutes.html">routes/AdminDashboardRoutes</a></li><li><a href="module-routes_AdminRoutes.html">routes/AdminRoutes</a></li><li><a href="module-routes_DashboardRoutes.html">routes/DashboardRoutes</a></li><li><a href="module-routes_IndexRoute.html">routes/IndexRoute</a></li><li><a href="module-routes_ModalRoutes.html">routes/ModalRoutes</a></li><li><a href="module-routes_ProtectedRoute.html">routes/ProtectedRoute</a></li><li><a href="module-routes_PublicRoutes.html">routes/PublicRoutes</a></li><li><a href="module-routes_Routes.html">routes/Routes</a></li><li><a href="module-services_assistantService.html">services/assistantService</a></li><li><a href="module-services_auth_handleLoginRedirect.html">services/auth/handleLoginRedirect</a></li><li><a href="module-services_auth_logoutRequest.html">services/auth/logoutRequest</a></li><li><a href="module-services_auth_roleUtils.html">services/auth/roleUtils</a></li><li><a href="module-services_auth_signInAuth.html">services/auth/signInAuth</a></li><li><a href="module-services_auth_signUpAuth.html">services/auth/signUpAuth</a></li><li><a href="module-services_avatarService.html">services/avatarService</a></li><li><a href="module-services_editorServices.html">services/editorServices</a></li><li><a href="module-services_fileService.html">services/fileService</a></li><li><a href="module-services_kanbanService.html">services/kanbanService</a></li><li><a href="module-services_profileService.html">services/profileService</a></li><li><a href="module-services_projectService.html">services/projectService</a></li><li><a href="module-services_taskService.html">services/taskService</a></li><li><a href="module-services_userService.html">services/userService</a></li><li><a href="module-theme.html">theme</a></li><li><a href="module-utils_authUtils.html">utils/authUtils</a></li><li><a href="module-utils_axiosConfig.html">utils/axiosConfig</a></li><li><a href="module-utils_cleanMentorOutput.html">utils/cleanMentorOutput</a></li><li><a href="module-utils_getRedirectForRole.html">utils/getRedirectForRole</a></li><li><a href="module-utils_monacoConfig.html">utils/monacoConfig</a></li><li><a href="module-utils_syncUserAndRedirect.html">utils/syncUserAndRedirect</a></li><li><a href="module-utils_taskUtils.html">utils/taskUtils</a></li><li><a href="module-utils_userToken.html">utils/userToken</a></li><li><a href="module-views_unauthorized.html">views/unauthorized</a></li><li><a href="vite.module_config.html">vite.config</a></li></ul><h3>Classes</h3><ul><li><a href="-_src_server_project.ts_-ConfiguredProject2.html">ConfiguredProject2</a></li><li><a href="-_src_server_project.ts_-ExternalProject2.html">ExternalProject2</a></li><li><a href="-_src_server_project.ts_-InferredProject2.html">InferredProject2</a></li><li><a href="-_src_server_project.ts_-Project3.html">Project3</a></li><li><a href="-_src_server_project.ts_-_AutoImportProviderProject.html">_AutoImportProviderProject</a></li><li><a href="-_src_services_textChanges.ts_-ChangeTracker.html">ChangeTracker</a></li><li><a href="module-components_ErrorBoundaryWrapper-ErrorBoundaryWrapper.html">ErrorBoundaryWrapper</a></li></ul><h3>Events</h3><ul><li><a href="module-utils_userToken.html#~event:onIdTokenChanged">onIdTokenChanged</a></li></ul><h3>Global</h3><ul><li><a href="global.html#renderWithRouter">renderWithRouter</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Thu Feb 12 2026 12:04:01 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
